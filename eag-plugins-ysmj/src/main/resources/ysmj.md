## 燕山门禁插件使用说明
------
### 1. 数据传送说明
- 插件使用WebService进行数据传送，每条数据的组成方式为：
  - 门禁服务器@控制器名称@点位名称
- 其中数据分为三段，@为分隔符
  - “门禁服务器”字段是固定的，与门禁软硬件配置无关；
  - “控制器名称”字段显示门禁软件中设置的控制器名称；
  - “点位名称”是各种事件点位的名称；
- 只读点位:
  - 门x模式开关：远程自动：80；远程常闭：82；远程常开：83 （硬件读走不清零）(WebService中可读到)
  - 门x本地事件：门已打开：6；门已关闭：5；门被意外打开：1；（硬件读走清零）(WebService中需要循环读取才有可能读到)
  - 韦根x刷卡事件：非法访问：-1；验证通过：100；双人等待(刷卡)：99；潜入：7；胁迫开门：8 （硬件读走清零）(WebService中需要循环读取才有可能读到)
  - 防拆：正常：1；被拆：0 （硬件读走不清零）(WebService中可读到)
  - 门x超时报警位：1:报警；0:未报警 （硬件读走不清零）(WebService中可读到)
  - 出门按钮x：1：出门按钮按下；（硬件读走清零）(WebService中需要循环读取才有可能读到)
  - 门磁1：1：回路闭合；0：回路断开（硬件读走不清零）
  - 韦根x HID码\韦根x PID码:（硬件读走清零）(WebService中需要循环读取才有可能读到)
  - 卡号x:韦根x端口刷卡读取到的卡号,由(韦根x HID码*65536+韦根x PID码)计算得到 (非硬件提供)(WebService中可读到)
  - 上次动作时间（年、月、日、时、分、秒）:（硬件读走清零）(WebService中需要循环读取才有可能读到)
  - 刷卡时间x：是从1970年零时到现在的毫秒值；(非硬件提供)(WebService中可读到)
  - 由于门禁软件实时监控界面与WebService同时都能读到上述数据,因此分析WebService数据是从门禁数据库缓存中读取.

- 可写点位:
  - 门锁开关x:写0设置为自动/写2设置为常闭/写3设置为常开/写1设置为远程打开,自动延时关闭(写1之前控制器必须设置为自动模式,否则写1无效)

### 2. 版本更新说明
|版本号|更新内容|
|-----|-----|
|1.5.1.1|初始记录版本|
|1.5.1.2|修改读值总是被清空的bug|
|1.5.1.3|优化格式|

### 3. 字段属性
#### 设备属性
- 远程IP地址：门禁服务器所在计算机IP；
- 远程端口：门禁服务端口，默认为8010；

#### 点位属性
- 点位：只读点位或者只写点位对应具体点位信息，为动态字段，会动态加载当前服务下的所有点位；
- 点位类型、数据类型、读写类型对应关系：

|点位类型|数据类型|读写类型|寄存器类型|
|-----|-----|-----|-----|
|只读点位|字符串|只读|状态寄存器|
|只写点位|字符串|只写|控制寄存器|

### 4. 点位新建
- 因点位中有动态字段，应当在建好设备后重启系统，再将设备启动，然后再新建设备；
- 当前插件的协议只有上述一些点位，只读只写未进行区分，在选择点位的时候一定要和读写类型及寄存器类型对应起来；

### 5. 日志含义
#### 点位验证
- Wrong format of ip address on device: {}
- 设备属性中IP地址格式错误；
- Point read-write type should be write-only on control point: {}
- Point read-write type should be read-only on status point: {}
- Invalid point register type on point: {}
- 都是因为读写类型与寄存器类型不对应；

#### 点位读写
- Read failed.
- 读取失败，请检查门禁服务是否开启；
- Read succeed but the number of variables is zero.
- 读到的点位数量为0，说明门禁服务对外发布的点位数量为0；
- Failed to write to point:{}.
- 写值失败，可能是因为点位类型和读写类型不对应；
- Found no dynamic data called {}
- 动态点位加载失败，请联系插件开发人员；